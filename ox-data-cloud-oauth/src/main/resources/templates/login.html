<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title th:text="${systemTitle} ? ${systemTitle} : 'ODC'"></title>
    <link th:href="@{static/bootstrap-5.1.3-dist/css/bootstrap.min.css}" rel="stylesheet" />
    <script th:src="@{/static/bootstrap-5.1.3-dist/js/bootstrap.min.js}"></script>
    <script th:src="@{/static/jquery-3.6.0.js}"></script>
    <script th:src="@{/static/js.cookie.min.js}"></script>
</head>
<body>
    <img th:src="@{/static/img/bg-odc.png}" class="bg-image"/>
    <div class="login-container">
        <div class="login-form">
            <form target="_parent" method="POST" th:action="@{/oauth/token}">
                <div class="mb-3">
                    <label class="form-label"><h3>登录</h3></label>
                </div>

                <div class="mb-3">
                    <label for="username" class="form-label">用户名</label>
                    <input type="text" class="form-control" id="username" aria-describedby="username" name="username">
                    <div id="emailHelp" class="form-text">请输入用户名或邮箱进行登录</div>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">密码</label>
                    <input type="password" class="form-control" id="password" name="password">
                </div>
                <div class="mb-3 d-grid gap-2">
                    <button type="submit" class="btn btn-primary">登录</button>

                </div>
            </form>
        </div>
    </div>
</body>
<script>
    $(function () {
        $('form').on('submit', function (e) {
            e.preventDefault();
            var form = $(this);
            var settings = {
                "url": form.attr('action'),
                "method": "POST",
                "timeout": 0,
                "headers": {
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                "data": {
                    "client_id": "butterfly",
                    "client_secret": "123123",
                    "username": form.find('input[name="username"]').val(),
                    "password": form.find('input[name="password"]').val(),
                    "grant_type": "password"
                }
            };

            $.ajax(settings).done(function (response) {
                console.log(response);
                Cookies.set('access_token', response.access_token, { expires: response.expires_in });
                window.location.href = "/oauth/home";
            }).catch(function (error) {
                const errorData = error.responseJSON;
                console.log(errorData);
                if (errorData.error === 'invalid_grant') {
                    alert(errorData.error_description);
                } else {
                    alert('登录失败');
                }
            });
        });
    });
</script>
<style>
    .bg-image {
        position: fixed;
        height: 100%;
        left: 0;
        bottom: 0;
        z-index: -1;
    }
    .login-container {
        position: absolute;
        top: 50%;
        right: 20%;
        transform: translate(-20%, -50%);
    }
    .login-form {
        width: 400px;
    }
</style>
</html>